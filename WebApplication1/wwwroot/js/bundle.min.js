function loadCategories(){fetch("?handler=Categories").then(n=>n.json()).then(n=>{renderCategories(n)}).catch(n=>{console.error("Error loading categories:",n),document.getElementById("categoriesMenu").innerHTML='<p class="error">Ошибка загрузки категорий<\/p>'})}function renderCategories(n){const i=document.getElementById("categoriesMenu");i.innerHTML="";const t={};n.forEach(n=>{t[n.id]=n,n.children=[]});const r=[];n.forEach(n=>{n.parentId===-1?r.push(n):t[n.parentId]&&t[n.parentId].children.push(n)});r.forEach(n=>{i.appendChild(createCategoryElement(n))})}function createCategoryElement(n){const t=document.createElement("li");t.className="category-item";const i=document.createElement("a");if(i.href="#",i.className="category-link",i.textContent=n.name,i.setAttribute("data-category-id",n.id),i.addEventListener("click",function(t){t.preventDefault();loadProductsByCategory(n.id)}),t.appendChild(i),n.children&&n.children.length>0){const i=document.createElement("ul");i.className="subcategory-list";n.children.forEach(n=>{i.appendChild(createCategoryElement(n))});t.appendChild(i)}if(n.children&&n.children.length>0){t.classList.add("has-children");i.addEventListener("click",function(n){n.preventDefault();t.classList.toggle("open")});const r=document.createElement("ul");r.className="subcategory-list";n.children.forEach(n=>{r.appendChild(createCategoryElement(n))});t.appendChild(r)}return t}document.addEventListener("DOMContentLoaded",function(){loadCategories()});