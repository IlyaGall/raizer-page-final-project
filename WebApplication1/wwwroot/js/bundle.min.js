function loadCategories(){fetch("?handler=Categories").then(n=>n.json()).then(n=>{renderCategories(n)}).catch(n=>{console.error("Error loading categories:",n),document.getElementById("categoriesMenu").innerHTML='<p class="error">Ошибка загрузки категорий<\/p>'})}function renderCategories(n){if(Array.isArray(n)){const r=document.getElementById("categoriesMenu");r.innerHTML="";const u=[...new Map(n.map(n=>[n.id,n])).values()],t=new Map;u.forEach(n=>{t.set(n.id,JSON.parse(JSON.stringify(n)))});const i=[];t.forEach(n=>{if(n.parentId===-1)i.push(n);else if(t.has(n.parentId)){const i=t.get(n.parentId);i.children||(i.children=[]);i.children.some(t=>t.id===n.id)||i.children.push(n)}});i.forEach(n=>{r.appendChild(createCategoryElement(n))});console.log("Processed categories:",{originalCount:n.length,uniqueCount:u.length,rootCategories:i})}}function createCategoryElement(n){const t=document.createElement("li");t.className="category-item";const i=document.createElement("a");if(i.href="#",i.className="category-link",i.textContent=n.name,i.setAttribute("data-category-id",n.id),i.addEventListener("click",function(i){i.preventDefault();n.children&&n.children.length>0?t.classList.toggle("open"):loadProductsByCategory(n.id)}),t.appendChild(i),n.children&&n.children.length>0){t.classList.add("has-children");const i=document.createElement("ul");i.className="subcategory-list";const r=Array.from(new Set(n.children.map(n=>n.id))).map(t=>n.children.find(n=>n.id===t));r.forEach(n=>{i.appendChild(createCategoryElement(n))});t.appendChild(i)}return t}document.addEventListener("DOMContentLoaded",function(){loadCategories()});